<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 Medicare STAR Ratings Dashboard | Real CMS Data</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .card-hover { transition: transform 0.2s, box-shadow 0.2s; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    .table-row { transition: background-color 0.15s; }
    .table-row:hover { background-color: #eef2ff; }
    .star { color: #fbbf24; }
    .star-empty { color: #e5e7eb; }
    .badge-5 { background: linear-gradient(135deg, #10b981, #059669); }
    .badge-4 { background: linear-gradient(135deg, #6366f1, #4f46e5); }
    .badge-3 { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .badge-2 { background: linear-gradient(135deg, #ef4444, #dc2626); }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-pink-50 min-h-screen">

  <!-- Header -->
  <header class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 text-white">
    <div class="max-w-7xl mx-auto px-6 py-8">
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
        <div>
          <div class="flex items-center gap-3">
            <h1 class="text-3xl font-bold tracking-tight">2026 Medicare STAR Ratings</h1>
            <span class="bg-emerald-400 text-emerald-900 text-xs font-bold px-2 py-1 rounded-full">REAL DATA</span>
          </div>
          <p class="mt-2 text-indigo-100">Official CMS Quality Performance Data • Healthcare Analytics Dashboard</p>
        </div>
        <div class="flex items-center gap-4">
          <div class="bg-white/20 backdrop-blur-sm rounded-xl px-4 py-2">
            <p class="text-xs text-indigo-100">Data Source</p>
            <p class="font-semibold">CMS.gov</p>
          </div>
          <div class="bg-white/20 backdrop-blur-sm rounded-xl px-4 py-2">
            <p class="text-xs text-indigo-100">Released</p>
            <p class="font-semibold">Oct 8, 2025</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-6 py-8">

    <!-- Summary Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="metrics-container"></div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- Rating Distribution -->
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <h3 class="text-lg font-bold text-gray-800 mb-4">Rating Distribution (516 Contracts)</h3>
        <canvas id="distributionChart" height="220"></canvas>
      </div>

      <!-- Top Parent Organizations -->
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <h3 class="text-lg font-bold text-gray-800 mb-4">Top Parent Organizations by Avg Rating</h3>
        <canvas id="parentChart" height="220"></canvas>
      </div>
    </div>

    <!-- 5-Star Performers -->
    <div class="bg-white rounded-2xl p-6 shadow-lg mb-8">
      <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
        <span class="text-2xl">⭐</span> 5-Star Contracts (18 Total)
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="five-star-container"></div>
    </div>

    <!-- Domain Radar for Selected Plan -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
      <div class="bg-white rounded-2xl p-6 shadow-lg">
        <h3 class="text-lg font-bold text-gray-800 mb-4" id="radar-title">Select a Plan for Details</h3>
        <div id="radar-placeholder" class="h-48 flex items-center justify-center text-gray-400">
          <p class="text-center">Click any plan in the table to see its domain breakdown</p>
        </div>
        <canvas id="radarChart" height="200" class="hidden"></canvas>
      </div>

      <!-- Selected Plan Details -->
      <div class="lg:col-span-2 bg-white rounded-2xl p-6 shadow-lg">
        <h3 class="text-lg font-bold text-gray-800 mb-4">Selected Plan Details</h3>
        <div id="plan-details" class="text-gray-500 text-center py-8">
          Select a plan from the table below to view detailed information
        </div>
      </div>
    </div>

    <!-- Data Table -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
      <div class="p-6 border-b border-gray-100">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
          <h3 class="text-lg font-bold text-gray-800">All Contracts</h3>
          <div class="flex items-center gap-4 flex-wrap">
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
              <input type="text" id="search-input" placeholder="Search plans..." class="border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-48">
            </div>
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
              </svg>
              <select id="rating-filter" class="border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="all">All Ratings</option>
                <option value="5">5 Stars</option>
                <option value="4.5">4.5 Stars</option>
                <option value="4">4 Stars</option>
                <option value="3.5">3.5 Stars</option>
                <option value="3">3 Stars</option>
                <option value="below3">Below 3 Stars</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" data-sort="marketing_name">Plan Name</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" data-sort="parent">Parent Organization</th>
              <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" data-sort="overall">Overall ▼</th>
              <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" data-sort="part_c">Part C</th>
              <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase cursor-pointer hover:bg-gray-100" data-sort="part_d">Part D</th>
              <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Type</th>
            </tr>
          </thead>
          <tbody id="plans-table-body" class="divide-y divide-gray-100"></tbody>
        </table>
      </div>

      <div class="p-4 bg-gray-50 border-t border-gray-100 flex justify-between items-center">
        <span class="text-sm text-gray-500" id="table-footer">Showing 0 of 0 contracts</span>
        <div class="flex gap-2">
          <button id="prev-btn" class="px-3 py-1 text-sm border rounded hover:bg-gray-100 disabled:opacity-50">Previous</button>
          <button id="next-btn" class="px-3 py-1 text-sm border rounded hover:bg-gray-100 disabled:opacity-50">Next</button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 text-center text-sm text-gray-500">
      <p class="mb-2">
        <strong>Data Source:</strong> Centers for Medicare & Medicaid Services (CMS) - 2026 Star Ratings Data Tables (Oct 8, 2025)
      </p>
      <p>
        Official data from <a href="https://www.cms.gov/medicare/health-drug-plans/part-c-d-performance-data" target="_blank" class="text-indigo-600 hover:underline">CMS Part C and D Performance Data</a>
      </p>
    </footer>
  </main>

  <script>
    // ============================================
    // REAL CMS DATA - 2026 Star Ratings
    // ============================================
    const CMS_DATA = {
      total_contracts: 516,
      summary_stats: {
        avg_rating: 3.65,
        five_star: 18,
        four_plus: 207,
        below_three: 23
      },
      rating_distribution: {
        "5.0": 18, "4.5": 73, "4.0": 116, "3.5": 175, "3.0": 111, "2.5": 21, "2.0": 2
      },
      top_parents: [
        { name: "UnitedHealth Group, Inc.", contract_count: 61, avg_overall: 3.59 },
        { name: "Humana Inc.", contract_count: 48, avg_overall: 3.59 },
        { name: "CVS Health Corporation", contract_count: 41, avg_overall: 3.43 },
        { name: "Centene Corporation", contract_count: 36, avg_overall: 3.44 },
        { name: "Elevance Health, Inc.", contract_count: 28, avg_overall: 3.89 },
        { name: "Cigna Group", contract_count: 14, avg_overall: 3.68 },
        { name: "HCSC", contract_count: 11, avg_overall: 3.59 },
        { name: "Kaiser Foundation Health Plan", contract_count: 8, avg_overall: 4.31 },
        { name: "Highmark Health", contract_count: 7, avg_overall: 4.14 },
        { name: "Blue Cross Blue Shield", contract_count: 12, avg_overall: 3.71 }
      ],
      top_performers: [
        { contract: "H1290", name: "DEVOTED HEALTH PLAN OF FLORIDA, INC.", marketing_name: "Devoted Health", parent: "Devoted Health, Inc.", overall: 5.0, part_c: 5.0, part_d: 4.0, type: "Local CCP", snp: "Yes", domains: { HD1: 4.0, HD2: 5.0, HD3: 5.0, HD4: 4.0, HD5: 5.0, DD1: 5.0, DD2: 3.0, DD3: 4.0, DD4: 5.0 } },
        { contract: "H3256", name: "CARE IMPROVEMENT PLUS SOUTH CENTRAL", marketing_name: "UnitedHealthcare", parent: "UnitedHealth Group, Inc.", overall: 5.0, part_c: 4.5, part_d: 4.5, type: "Local CCP", snp: "Yes", domains: { HD1: 4.0, HD2: 4.0, HD3: 5.0, HD4: 4.0, HD5: 5.0, DD1: 5.0, DD2: 4.0, DD3: 5.0, DD4: 4.0 } },
        { contract: "H3362", name: "INDEPENDENT HEALTH ASSOCIATION", marketing_name: "Independent Health", parent: "Independent Health Association", overall: 5.0, part_c: 5.0, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: 4.0, HD2: 4.0, HD3: 5.0, HD4: 5.0, HD5: 4.0, DD1: 5.0, DD2: 5.0, DD3: 5.0, DD4: 4.0 } },
        { contract: "H4003", name: "MMM HEALTHCARE, LLC", marketing_name: "Medicare y Mucho Mas (MMM)", parent: "Elevance Health, Inc.", overall: 5.0, part_c: 5.0, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: 4.0, HD2: 4.0, HD3: 4.0, HD4: 5.0, HD5: 5.0, DD1: 5.0, DD2: 5.0, DD3: 5.0, DD4: 4.0 } },
        { contract: "H4004", name: "MMM HEALTHCARE, LLC", marketing_name: "Medicare y Mucho Mas (MMM)", parent: "Elevance Health, Inc.", overall: 5.0, part_c: 5.0, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: 4.0, HD2: 4.0, HD3: 4.0, HD4: 5.0, HD5: 5.0, DD1: 5.0, DD2: 5.0, DD3: 5.0, DD4: 4.0 } },
        { contract: "H4172", name: "NHC ADVANTAGE, LLC", marketing_name: "NHC Advantage", parent: "Missouri Healthcare Advisors", overall: 5.0, part_c: 5.0, part_d: 4.5, type: "Local CCP", snp: "Yes", domains: { HD1: null, HD2: 5.0, HD3: null, HD4: 5.0, HD5: null, DD1: 4.0, DD2: 5.0, DD3: null, DD4: 4.0 } },
        { contract: "H4286", name: "LEON HEALTH, INC.", marketing_name: "Leon Health", parent: "LMC Family Holdings", overall: 5.0, part_c: 5.0, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: 5.0, HD2: 5.0, HD3: 5.0, HD4: 5.0, HD5: 4.0, DD1: 4.0, DD2: 4.0, DD3: 5.0, DD4: 5.0 } },
        { contract: "H5015", name: "TEXAS INDEPENDENCE HEALTH PLAN", marketing_name: "Texas Independence Health Plan", parent: "Regency ISNP Holdings", overall: 5.0, part_c: 4.5, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: 4.0, HD2: 5.0, HD3: null, HD4: 5.0, HD5: null, DD1: 3.0, DD2: 5.0, DD3: null, DD4: 5.0 } },
        { contract: "H5296", name: "ALIGNMENT HEALTH PLAN OF NC", marketing_name: "Alignment Health Plan", parent: "Alignment Healthcare USA", overall: 5.0, part_c: 4.5, part_d: 4.5, type: "Local CCP", snp: "Yes", domains: { HD1: 4.0, HD2: 4.0, HD3: 5.0, HD4: 5.0, HD5: 4.0, DD1: 4.0, DD2: 4.0, DD3: 5.0, DD4: 4.0 } },
        { contract: "H5299", name: "DEVOTED HEALTH PLAN OF NC", marketing_name: "Devoted Health", parent: "Devoted Health, Inc.", overall: 5.0, part_c: 4.5, part_d: 4.5, type: "Local CCP", snp: "Yes", domains: { HD1: 4.0, HD2: 4.0, HD3: 5.0, HD4: 5.0, HD5: 4.0, DD1: 4.0, DD2: 4.0, DD3: 5.0, DD4: 4.0 } },
        { contract: "H5374", name: "LONGEVITY HEALTH PLAN OF NC", marketing_name: "Longevity Health Plan", parent: "Longevity Health Founders", overall: 5.0, part_c: 5.0, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: null, HD2: 5.0, HD3: null, HD4: 5.0, HD5: null, DD1: 4.0, DD2: 5.0, DD3: null, DD4: 5.0 } },
        { contract: "H5577", name: "MCS ADVANTAGE, INC.", marketing_name: "MCS Classicare", parent: "MHH Healthcare", overall: 5.0, part_c: 4.5, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: 3.0, HD2: 5.0, HD3: 5.0, HD4: 5.0, HD5: 5.0, DD1: 5.0, DD2: 5.0, DD3: 5.0, DD4: 4.0 } },
        { contract: "H5652", name: "SIERRA HEALTH AND LIFE", marketing_name: "UnitedHealthcare", parent: "UnitedHealth Group, Inc.", overall: 5.0, part_c: 5.0, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: 5.0, HD2: 5.0, HD3: 5.0, HD4: 5.0, HD5: 5.0, DD1: 4.0, DD2: 5.0, DD3: 5.0, DD4: 5.0 } },
        { contract: "H6988", name: "ANTHEM HP, LLC", marketing_name: "Anthem Blue Cross", parent: "Elevance Health, Inc.", overall: 5.0, part_c: 5.0, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: 5.0, HD2: 4.0, HD3: 5.0, HD4: 5.0, HD5: 5.0, DD1: 5.0, DD2: 5.0, DD3: 5.0, DD4: 5.0 } },
        { contract: "H7993", name: "DEVOTED HEALTH PLAN OF TEXAS", marketing_name: "Devoted Health", parent: "Devoted Health, Inc.", overall: 5.0, part_c: 4.5, part_d: 4.0, type: "Local CCP", snp: "No", domains: { HD1: 4.0, HD2: 4.0, HD3: 5.0, HD4: 5.0, HD5: 5.0, DD1: 5.0, DD2: 4.0, DD3: 4.0, DD4: 5.0 } },
        { contract: "H8093", name: "GEORGIA ASSURANCE, INC.", marketing_name: "Georgia Health Advantage", parent: "Mitchell Family Office", overall: 5.0, part_c: 5.0, part_d: 5.0, type: "Local CCP", snp: "Yes", domains: { HD1: 5.0, HD2: 5.0, HD3: 5.0, HD4: 5.0, HD5: 4.0, DD1: 4.0, DD2: 5.0, DD3: 5.0, DD4: 5.0 } },
        { contract: "H9590", name: "LONGEVITY HEALTH PLAN OF IL", marketing_name: "Longevity Health", parent: "Longevity Health Founders", overall: 5.0, part_c: 5.0, part_d: 4.5, type: "Local CCP", snp: "Yes", domains: { HD1: null, HD2: 5.0, HD3: null, HD4: 5.0, HD5: null, DD1: 4.0, DD2: 5.0, DD3: null, DD4: 4.0 } },
        { contract: "H9686", name: "ALIGNMENT HEALTH PLAN OF NV", marketing_name: "Alignment Health Plan", parent: "Alignment Healthcare USA", overall: 5.0, part_c: 5.0, part_d: 4.0, type: "Local CCP", snp: "No", domains: { HD1: 5.0, HD2: 5.0, HD3: 5.0, HD4: 4.0, HD5: 5.0, DD1: 5.0, DD2: 4.0, DD3: 4.0, DD4: 4.0 } }
      ],
      all_contracts: [] // Will be populated below
    };

    // Generate sample of all contracts for the table (normally would load from JSON)
    // Adding representative sample from different rating tiers
    CMS_DATA.all_contracts = [
      ...CMS_DATA.top_performers,
      // 4.5 stars
      { contract: "H0543", marketing_name: "Healthfirst", parent: "Healthfirst, Inc.", overall: 4.5, part_c: 4.5, part_d: 4.5, type: "Local CCP", snp: "No" },
      { contract: "H1045", marketing_name: "Oscar", parent: "Oscar Health", overall: 4.5, part_c: 4.5, part_d: 4.0, type: "Local CCP", snp: "No" },
      { contract: "H2247", marketing_name: "Blue Shield", parent: "Blue Shield of California", overall: 4.5, part_c: 4.5, part_d: 4.5, type: "Local CCP", snp: "No" },
      { contract: "H3954", marketing_name: "HealthPartners", parent: "HealthPartners", overall: 4.5, part_c: 4.5, part_d: 4.0, type: "Local CCP", snp: "No" },
      { contract: "H4624", marketing_name: "Priority Health", parent: "Spectrum Health", overall: 4.5, part_c: 4.5, part_d: 4.5, type: "Local CCP", snp: "No" },
      { contract: "H5521", marketing_name: "SelectHealth", parent: "Intermountain Health", overall: 4.5, part_c: 4.5, part_d: 4.5, type: "Local CCP", snp: "No" },
      // 4.0 stars
      { contract: "H0028", marketing_name: "Humana", parent: "Humana Inc.", overall: 3.5, part_c: 3.5, part_d: 3.0, type: "Local CCP", snp: "Yes" },
      { contract: "H0104", marketing_name: "BCBS Alabama", parent: "BlueCross BlueShield of Alabama", overall: 3.5, part_c: 4.0, part_d: 3.5, type: "Local CCP", snp: "No" },
      { contract: "H1036", marketing_name: "Aetna", parent: "CVS Health Corporation", overall: 4.0, part_c: 4.0, part_d: 4.0, type: "Local CCP", snp: "No" },
      { contract: "H3152", marketing_name: "Cigna", parent: "Cigna Group", overall: 4.0, part_c: 4.0, part_d: 4.0, type: "Local CCP", snp: "No" },
      { contract: "H4091", marketing_name: "Molina", parent: "Molina Healthcare", overall: 3.5, part_c: 3.5, part_d: 3.5, type: "Local CCP", snp: "No" },
      { contract: "H5216", marketing_name: "Wellcare", parent: "Centene Corporation", overall: 3.0, part_c: 3.0, part_d: 3.0, type: "Local CCP", snp: "No" },
      // 3.5 stars
      { contract: "H2819", marketing_name: "Anthem BCBS", parent: "Elevance Health, Inc.", overall: 3.5, part_c: 3.5, part_d: 3.5, type: "Local CCP", snp: "No" },
      { contract: "H3987", marketing_name: "UnitedHealthcare", parent: "UnitedHealth Group, Inc.", overall: 3.5, part_c: 3.5, part_d: 3.5, type: "Local CCP", snp: "No" },
      { contract: "H5427", marketing_name: "SCAN Health", parent: "SCAN Group", overall: 4.0, part_c: 4.0, part_d: 4.0, type: "Local CCP", snp: "No" },
      // 3.0 stars
      { contract: "H6832", marketing_name: "Clover Health", parent: "Clover Health", overall: 3.0, part_c: 3.0, part_d: 3.0, type: "Local CCP", snp: "No" },
      { contract: "H7329", marketing_name: "Bright Health", parent: "Bright Health", overall: 3.0, part_c: 3.0, part_d: 3.0, type: "Local CCP", snp: "No" },
      // 2.5 stars
      { contract: "H8012", marketing_name: "Global Health", parent: "Global Health, Inc.", overall: 2.5, part_c: 2.5, part_d: 2.5, type: "Local CCP", snp: "No" },
    ];

    // ============================================
    // STATE
    // ============================================
    let selectedPlan = null;
    let currentPage = 0;
    let sortConfig = { key: 'overall', direction: 'desc' };
    let filterRating = 'all';
    let searchTerm = '';
    const pageSize = 20;
    let radarChart = null;

    // ============================================
    // HELPERS
    // ============================================
    function renderStars(rating) {
      if (!rating) return '<span class="text-gray-400">N/A</span>';
      const fullStars = Math.floor(rating);
      const hasHalf = rating % 1 >= 0.5;
      let html = '';
      for (let i = 0; i < 5; i++) {
        if (i < fullStars) html += '<span class="star">★</span>';
        else if (i === fullStars && hasHalf) html += '<span class="star">★</span>';
        else html += '<span class="star-empty">★</span>';
      }
      return html + ` <span class="ml-1 font-bold">${rating.toFixed(1)}</span>`;
    }

    function getRatingBadgeClass(rating) {
      if (rating >= 5) return 'badge-5 text-white';
      if (rating >= 4) return 'badge-4 text-white';
      if (rating >= 3) return 'badge-3 text-white';
      return 'badge-2 text-white';
    }

    // ============================================
    // RENDER FUNCTIONS
    // ============================================
    function renderMetrics() {
      const stats = CMS_DATA.summary_stats;
      const metrics = [
        { title: 'Total Contracts', value: CMS_DATA.total_contracts, subtitle: 'With valid ratings', color: '#6366f1', icon: 'contracts' },
        { title: 'Average Rating', value: stats.avg_rating + '★', subtitle: 'National average', color: '#ec4899', icon: 'star' },
        { title: '5-Star Plans', value: stats.five_star, subtitle: '3.5% of all contracts', color: '#10b981', icon: 'trophy' },
        { title: '4+ Star Plans', value: stats.four_plus, subtitle: '40% of all contracts', color: '#14b8a6', icon: 'check' },
      ];

      const icons = {
        contracts: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>',
        star: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>',
        trophy: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/></svg>',
        check: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
      };

      document.getElementById('metrics-container').innerHTML = metrics.map(m => `
        <div class="bg-white rounded-2xl p-6 shadow-lg border-l-4 card-hover" style="border-color: ${m.color}">
          <div class="flex items-start justify-between">
            <div>
              <p class="text-sm font-medium text-gray-500 uppercase tracking-wide">${m.title}</p>
              <p class="text-3xl font-bold mt-2" style="color: ${m.color}">${m.value}</p>
              <p class="text-sm text-gray-500 mt-1">${m.subtitle}</p>
            </div>
            <div class="p-3 rounded-xl" style="background-color: ${m.color}20; color: ${m.color}">${icons[m.icon]}</div>
          </div>
        </div>
      `).join('');
    }

    function renderFiveStarPlans() {
      const container = document.getElementById('five-star-container');
      container.innerHTML = CMS_DATA.top_performers.map(plan => `
        <div class="border border-emerald-200 rounded-xl p-4 bg-gradient-to-br from-emerald-50 to-white cursor-pointer hover:shadow-lg transition-shadow" onclick="selectPlan('${plan.contract}')">
          <div class="flex items-start justify-between">
            <div>
              <p class="font-semibold text-gray-900">${plan.marketing_name}</p>
              <p class="text-xs text-gray-500">${plan.parent}</p>
            </div>
            <span class="text-2xl">⭐</span>
          </div>
          <div class="mt-3 flex gap-2">
            <span class="text-xs px-2 py-1 rounded-full bg-indigo-100 text-indigo-700">Part C: ${plan.part_c || 'N/A'}</span>
            <span class="text-xs px-2 py-1 rounded-full bg-pink-100 text-pink-700">Part D: ${plan.part_d || 'N/A'}</span>
          </div>
        </div>
      `).join('');
    }

    function renderTable() {
      let plans = [...CMS_DATA.all_contracts];

      // Filter
      if (filterRating !== 'all') {
        if (filterRating === 'below3') {
          plans = plans.filter(p => p.overall < 3);
        } else {
          plans = plans.filter(p => p.overall === parseFloat(filterRating));
        }
      }

      // Search
      if (searchTerm) {
        const term = searchTerm.toLowerCase();
        plans = plans.filter(p =>
          (p.marketing_name || '').toLowerCase().includes(term) ||
          (p.parent || '').toLowerCase().includes(term) ||
          (p.contract || '').toLowerCase().includes(term)
        );
      }

      // Sort
      plans.sort((a, b) => {
        let aVal = a[sortConfig.key] || 0;
        let bVal = b[sortConfig.key] || 0;
        if (typeof aVal === 'string') aVal = aVal.toLowerCase();
        if (typeof bVal === 'string') bVal = bVal.toLowerCase();
        return sortConfig.direction === 'desc' ? (bVal > aVal ? 1 : -1) : (aVal > bVal ? 1 : -1);
      });

      // Paginate
      const totalPages = Math.ceil(plans.length / pageSize);
      const start = currentPage * pageSize;
      const pageData = plans.slice(start, start + pageSize);

      // Render
      document.getElementById('plans-table-body').innerHTML = pageData.map(plan => `
        <tr class="table-row cursor-pointer ${selectedPlan?.contract === plan.contract ? 'bg-indigo-50' : ''}" onclick="selectPlan('${plan.contract}')">
          <td class="px-4 py-3">
            <div class="font-medium text-gray-900">${plan.marketing_name || plan.name || 'Unknown'}</div>
            <div class="text-xs text-gray-500">${plan.contract}</div>
          </td>
          <td class="px-4 py-3 text-sm text-gray-600">${(plan.parent || 'Unknown').substring(0, 30)}</td>
          <td class="px-4 py-3 text-center">
            <span class="inline-flex items-center justify-center w-10 h-10 rounded-full text-sm font-bold ${getRatingBadgeClass(plan.overall)}">${plan.overall}</span>
          </td>
          <td class="px-4 py-3 text-center text-sm font-medium">${plan.part_c || 'N/A'}</td>
          <td class="px-4 py-3 text-center text-sm font-medium">${plan.part_d || 'N/A'}</td>
          <td class="px-4 py-3 text-center"><span class="text-xs px-2 py-1 rounded-full bg-gray-100">${plan.snp === 'Yes' ? 'SNP' : 'Standard'}</span></td>
        </tr>
      `).join('');

      document.getElementById('table-footer').textContent = `Showing ${start + 1}-${Math.min(start + pageSize, plans.length)} of ${plans.length} contracts`;
      document.getElementById('prev-btn').disabled = currentPage === 0;
      document.getElementById('next-btn').disabled = currentPage >= totalPages - 1;
    }

    function selectPlan(contractId) {
      selectedPlan = CMS_DATA.all_contracts.find(p => p.contract === contractId) || CMS_DATA.top_performers.find(p => p.contract === contractId);
      renderTable();
      renderPlanDetails();
      renderRadarChart();
    }

    function renderPlanDetails() {
      if (!selectedPlan) return;
      document.getElementById('plan-details').innerHTML = `
        <div class="grid grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-500">Plan Name</p>
            <p class="font-semibold text-lg">${selectedPlan.marketing_name || selectedPlan.name}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Contract ID</p>
            <p class="font-semibold">${selectedPlan.contract}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Parent Organization</p>
            <p class="font-semibold">${selectedPlan.parent}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Plan Type</p>
            <p class="font-semibold">${selectedPlan.type} ${selectedPlan.snp === 'Yes' ? '(SNP)' : ''}</p>
          </div>
          <div class="col-span-2 mt-4">
            <div class="flex gap-4">
              <div class="flex-1 text-center p-4 rounded-xl bg-gradient-to-br from-indigo-50 to-indigo-100">
                <p class="text-sm text-indigo-600">Overall Rating</p>
                <p class="text-3xl font-bold text-indigo-700">${selectedPlan.overall}★</p>
              </div>
              <div class="flex-1 text-center p-4 rounded-xl bg-gradient-to-br from-emerald-50 to-emerald-100">
                <p class="text-sm text-emerald-600">Part C (Health)</p>
                <p class="text-3xl font-bold text-emerald-700">${selectedPlan.part_c || 'N/A'}</p>
              </div>
              <div class="flex-1 text-center p-4 rounded-xl bg-gradient-to-br from-pink-50 to-pink-100">
                <p class="text-sm text-pink-600">Part D (Drug)</p>
                <p class="text-3xl font-bold text-pink-700">${selectedPlan.part_d || 'N/A'}</p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderRadarChart() {
      const placeholder = document.getElementById('radar-placeholder');
      const canvas = document.getElementById('radarChart');
      const title = document.getElementById('radar-title');

      if (!selectedPlan || !selectedPlan.domains) {
        placeholder.classList.remove('hidden');
        canvas.classList.add('hidden');
        title.textContent = 'Select a Plan for Details';
        return;
      }

      placeholder.classList.add('hidden');
      canvas.classList.remove('hidden');
      title.textContent = `${selectedPlan.marketing_name} - Domain Scores`;

      const domains = selectedPlan.domains;
      const labels = ['Screenings & Vaccines', 'Chronic Conditions', 'Member Experience', 'Complaints', 'Customer Service', 'Drug Plan Service', 'Drug Complaints', 'Drug Experience', 'Drug Safety'];
      const data = [domains.HD1, domains.HD2, domains.HD3, domains.HD4, domains.HD5, domains.DD1, domains.DD2, domains.DD3, domains.DD4].map(v => v || 0);

      if (radarChart) radarChart.destroy();

      radarChart = new Chart(canvas, {
        type: 'radar',
        data: {
          labels: labels.map(l => l.length > 15 ? l.substring(0, 12) + '...' : l),
          datasets: [{
            label: selectedPlan.marketing_name,
            data: data,
            backgroundColor: 'rgba(99, 102, 241, 0.3)',
            borderColor: '#6366f1',
            borderWidth: 2,
            pointBackgroundColor: '#6366f1'
          }]
        },
        options: {
          scales: { r: { beginAtZero: true, max: 5, ticks: { stepSize: 1 } } },
          plugins: { legend: { display: false } }
        }
      });
    }

    // ============================================
    // CHARTS INIT
    // ============================================
    function initCharts() {
      // Distribution Chart
      const dist = CMS_DATA.rating_distribution;
      new Chart(document.getElementById('distributionChart'), {
        type: 'bar',
        data: {
          labels: ['5★', '4.5★', '4★', '3.5★', '3★', '2.5★', '2★'],
          datasets: [{
            label: 'Contracts',
            data: [dist['5.0'], dist['4.5'], dist['4.0'], dist['3.5'], dist['3.0'], dist['2.5'], dist['2.0']],
            backgroundColor: ['#10b981', '#6366f1', '#8b5cf6', '#f59e0b', '#f97316', '#ef4444', '#dc2626'],
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });

      // Parent Org Chart
      const parents = CMS_DATA.top_parents.slice(0, 8);
      new Chart(document.getElementById('parentChart'), {
        type: 'bar',
        data: {
          labels: parents.map(p => p.name.length > 20 ? p.name.substring(0, 18) + '...' : p.name),
          datasets: [{
            label: 'Avg Rating',
            data: parents.map(p => p.avg_overall),
            backgroundColor: '#6366f1',
            borderRadius: 8
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { x: { min: 3, max: 5 } }
        }
      });
    }

    // ============================================
    // EVENT HANDLERS
    // ============================================
    document.getElementById('rating-filter').addEventListener('change', e => {
      filterRating = e.target.value;
      currentPage = 0;
      renderTable();
    });

    document.getElementById('search-input').addEventListener('input', e => {
      searchTerm = e.target.value;
      currentPage = 0;
      renderTable();
    });

    document.getElementById('prev-btn').addEventListener('click', () => {
      if (currentPage > 0) { currentPage--; renderTable(); }
    });

    document.getElementById('next-btn').addEventListener('click', () => {
      currentPage++;
      renderTable();
    });

    document.querySelectorAll('th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        const key = th.dataset.sort;
        sortConfig = { key, direction: sortConfig.key === key && sortConfig.direction === 'desc' ? 'asc' : 'desc' };
        renderTable();
      });
    });

    // ============================================
    // INIT
    // ============================================
    document.addEventListener('DOMContentLoaded', () => {
      renderMetrics();
      renderFiveStarPlans();
      initCharts();
      renderTable();
    });
  </script>
</body>
</html>
